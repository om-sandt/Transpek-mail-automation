{% extends "base.html" %}

{% block title %}Approve Request #{{ request.id }} - Approval Workflow{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card border-success">
            <div class="card-header bg-success text-white">
                <h3 class="mb-0">
                    <i class="fas fa-check-circle"></i> Approve Request #{{ request.id }}
                </h3>
            </div>
            <div class="card-body">
                <!-- Request Details -->
                <div class="mb-4">
                    <h5><i class="fas fa-info-circle"></i> Request Details</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Request ID:</strong> #{{ request.id }}</p>
                            <p><strong>Approver Email:</strong> {{ request.approver_email }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Status:</strong> 
                                <span class="badge bg-warning">Pending</span>
                            </p>
                            <p><strong>Created:</strong> {{ request.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <label class="form-label"><strong>Request Data:</strong></label>
                        <div class="border rounded p-3 bg-light" style="max-height: 300px; overflow-y: auto;">
                            <pre style="white-space: pre-wrap; margin: 0; font-family: inherit;">{{ request.data }}</pre>
                        </div>
                    </div>
                </div>

                <!-- Approval Form -->
                <form method="POST" action="{{ url_for('process') }}">
                    <input type="hidden" name="request_id" value="{{ request.id }}">
                    <input type="hidden" name="status" value="Approved">
                    
                    <div class="mb-3">
                        <label for="reason" class="form-label">
                            <i class="fas fa-comment"></i> Approval Comments (Optional)
                        </label>
                        <textarea 
                            class="form-control" 
                            id="reason" 
                            name="reason" 
                            rows="4" 
                            placeholder="Add any comments or notes about this approval..."
                        ></textarea>
                        <div class="form-text">
                            Optional comments to provide context for this approval decision.
                        </div>
                    </div>

                    <div class="alert alert-success">
                        <i class="fas fa-info-circle"></i>
                        <strong>Note:</strong> By clicking "Approve Request", you are confirming that this request meets all requirements and can proceed.
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('index') }}" class="btn btn-secondary me-md-2">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-check"></i> Approve Request
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Action History -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-history"></i> Action History
                </h5>
            </div>
            <div class="card-body">
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-marker bg-primary">
                            <i class="fas fa-plus"></i>
                        </div>
                        <div class="timeline-content">
                            <h6>Request Submitted</h6>
                            <p class="text-muted mb-0">{{ request.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker bg-warning">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="timeline-content">
                            <h6>Pending Approval</h6>
                            <p class="text-muted mb-0">Awaiting your decision</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline-item {
    position: relative;
    margin-bottom: 20px;
}

.timeline-marker {
    position: absolute;
    left: -35px;
    top: 0;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.timeline-content h6 {
    margin-bottom: 5px;
    font-weight: 600;
}

.timeline-item:not(:last-child)::after {
    content: '';
    position: absolute;
    left: -20px;
    top: 30px;
    bottom: -20px;
    width: 2px;
    background-color: #dee2e6;
}
</style>
{% endblock %} 